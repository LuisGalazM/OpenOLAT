<div class="o_org_selector">
	<div class="clearfix">
		<div class="o_org_selector_search">
			<div id="$r.getId('org_search')" class="input-group">
				<div class="input-group-btn">
					$r.render("quickSearchButton")
				</div>
				$r.render("quickSearch")
				<div class="input-group-btn">
					$r.render("resetQuickSearch")
				</div>
			</div>
			<div class="o_org_selector_label">
				#if($r.visible("selector.selection.none"))
				$r.render("selector.selection.none", "label")
				<div class="o_org_selection_none">
					$r.render("selector.selection.none")
				</div>
				#end

				#if($r.visible("selector.selection.num"))
				$r.render("selector.selection.num", "label")
				#end
			</div>
		</div>
	</div>

	<div class="clearfix o_filter_search_list_values o_org_selector_selection">
		<div id="$r.getId('_selected_orgs_')" class="o_org_selector_selected">
			<div class="o_org_selector_rows">
				#foreach($selectedOrg in $selectedOrgs)
				<div class="o_org_selector_row">
					<div class="o_org_selector_checkbox">
						<input type="$inputType"
							   checked
							   onchange="propagateCheckedState(jQuery(`#$r.getId('_orgs_') #org_id_${this.value}`).prop('checked', this.checked);"
							   id="sel_org_id_${selectedOrg.key()}" 
							   name="sel_org_name_${selectedOrg.key()}" value="${selectedOrg.key()}" 
							   aria-labelledby="sel_org_label_${selectedOrg.key()}"
							   title="$r.translate("select")" >
					</div>
					<div class="o_org_selector_text">
						<div class="o_org_selector_status">$r.escapeHtml(${selectedOrg.path()})</div>
						<div id="sel_org_label_${selectedOrg.key()}" class="o_org_selector_title_version">
							$r.escapeHtml(${selectedOrg.title()}) 
							#if($selectedOrg.location()) &middot; $r.escapeHtml(${selectedOrg.location()}) #end
							#if($selectedOrg.numberOfElements()) (${selectedOrg.numberOfElements()}) #end
						</div>
					</div>
				</div>
				#end
			</div>
		</div>

		#if($selectedOrgs && $selectedOrgs.size() > 0 && $orgs && $orgs.size() > 0)
		<hr class="o_org_selector_separator">
		#end
		
		<div id="$r.getId('_orgs_')" class="o_org_selector_all">
			<div class="o_org_selector_rows">
				#foreach($org in $orgs)
				<div class="o_org_selector_row">
					<div class="o_org_selector_checkbox">
						<input type="$inputType"
							   #if($org.checked()) checked #end
							   onchange="jQuery(`#$r.getId('_selected_orgs_') #sel_org_id_${this.value}`).prop('checked', this.checked);"
							   id="org_id_${org.key()}" 
							   name="org_name_${org.key()}" value="${org.key()}"
							   aria-labelledby="org_label_${org.key()}"
							   title="$r.translate("select")" >
					</div>
					<div class="o_org_selector_text">
						<div class="o_org_selector_status">$r.escapeHtml(${org.path()})</div>
						<div id="org_label_${org.key()}" class="o_org_selector_title_version">
							$r.escapeHtml(${org.title()})
							#if($org.location()) &middot; $r.escapeHtml(${org.location()}) #end
							#if($org.numberOfElements()) (${org.numberOfElements()}) #end
						</div>
					</div>
				</div>
				#end
				#if($r.available("selector.load.more") && $r.visible("selector.load.more"))
				<div class="o_org_load_more">
					$r.render("selector.load.more")
				</div>
				#end
			</div>
		</div>
	</div>

	<div class="o_button_group o_button_group_left o_button_group_bottom o_button_group_shadow">
		#if($r.available("apply") && $r.visible("apply"))
		$r.render("apply")
		#end
	</div>
</div>

<script>
	"use strict";
	jQuery(function() {
		var searchField = jQuery('#$r.getId("org_search") input');
		if (!searchField.length) {
			return;
		}
		var searchFieldEl = searchField.get(0);
		var elemLen = searchFieldEl.value.length;
		if (searchFieldEl.selectionStart || searchFieldEl.selectionStart == '0') {
			searchFieldEl.selectionStart = elemLen;
			searchFieldEl.selectionEnd = elemLen;
			searchFieldEl.focus();
		}
	});
</script>
